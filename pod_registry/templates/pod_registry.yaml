---

{{ansible_managed|comment(decoration='#')}}

apiVersion: v1
kind: Pod
metadata:
  labels:
    app: registry
  name: pod_registry
spec:
  containers:
  - name: registry
    image: docker.io/library/registry:{{pod_registry_version}}
    ports:
    - name: registry
      containerPort: 5000
      hostPort: 5000
      protocol: TCP
    resources: {}
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - CAP_MKNOD
        - CAP_NET_RAW
        - CAP_AUDIT_WRITE
      privileged: false
      readOnlyRootFilesystem: {{pod_registry_read_only_root_filesystem|lower}}
      runAsGroup: 0
      runAsUser: 0
      seLinuxOptions:
        type: spc_t
    volumeMounts:
    - name: registry-data
      mountPath: /var/lib/registry
    - name: registry-auth
      mountPath: /auth
    workingDir: /
    env:
    - name: REGISTRY_AUTH_HTPASSWD_PATH
      value: /auth/htpasswd
    - name: REGISTRY_AUTH
      value: htpasswd
    - name: REGISTRY_AUTH_HTPASSWD_REALM
      value: Container Registry Realm

  dnsConfig: {}
  restartPolicy: Always

  volumes:
  - name: registry-data
    hostPath:
      type: Directory
      path: /opt/pod_registry/data
  - name: registry-auth
    hostPath:
      type: Directory
      path: /opt/pod_registry/auth

status: {}
